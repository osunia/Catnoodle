<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kanoodle Puzzle Generator</title>
    <style>
        :root {
            --bg-color: #f0f4f8;
            --board-bg: #2c3e50;
            --hole-color: #1a252f;
            --tray-bg: #ffffff;
            --primary-btn: #3498db;
            --secondary-btn: #e74c3c;
            --text-color: #333;
            --cell-size: 32px; /* ë°ìŠ¤í¬í†± ê¸°ë³¸ */
        }

        /* ğŸ“± ëª¨ë°”ì¼ ë°˜ì‘í˜• ì¡°ì • */
        @media (max-width: 600px) {
            :root {
                --cell-size: 8.5vw; /* í™”ë©´ ë„ˆë¹„ì— ë¹„ë¡€ */
            }
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
            touch-action: none; /* ìŠ¤í¬ë¡¤ ë°©ì§€ (ë“œë˜ê·¸ ê²½í—˜ í–¥ìƒ) */
        }

        header {
            margin: 20px 0;
            text-align: center;
        }

        h1 { margin: 0; font-size: 1.5rem; color: var(--board-bg); }
        p { margin: 5px 0 0; font-size: 0.9rem; color: #666; }

        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        select, button {
            padding: 8px 16px;
            border-radius: 20px;
            border: none;
            font-size: 0.9rem;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.1s;
        }

        button:active { transform: scale(0.95); }

        .btn-gen { background: var(--primary-btn); color: white; font-weight: bold; }
        .btn-check { background: #27ae60; color: white; }
        .btn-answer { background: var(--secondary-btn); color: white; }

        /* ê²Œì„ ì˜ì—­ */
        #game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            width: 100%;
        }

        /* ğŸ§© ë³´ë“œ ìŠ¤íƒ€ì¼ (Kanoodle ëŠë‚Œ) */
        #board {
            display: grid;
            grid-template-columns: repeat(11, var(--cell-size));
            grid-template-rows: repeat(5, var(--cell-size));
            gap: 2px;
            background-color: var(--board-bg);
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            position: relative;
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            background-color: var(--hole-color);
            border-radius: 50%; /* ì›í˜• êµ¬ë© */
            box-shadow: inset 2px 2px 5px rgba(0,0,0,0.5);
        }

        /* ğŸ– íŠ¸ë ˆì´ (ì¡°ê° ë†“ëŠ” ê³³) */
        #tray {
            width: 90%;
            min-height: 150px;
            background-color: var(--tray-bg);
            border-radius: 15px;
            padding: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 15px;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.05);
        }

        /* ì¡°ê° ìŠ¤íƒ€ì¼ */
        .piece {
            position: absolute; /* ë“œë˜ê·¸ ì¤‘ ìœ„ì¹˜ ì œì–´ */
            display: grid;
            gap: 2px;
            cursor: grab;
            touch-action: none;
            transition: transform 0.1s;
            z-index: 10;
        }
        
        .piece.in-tray {
            position: relative; /* íŠ¸ë ˆì´ ì•ˆì—ì„œëŠ” íë¦„ ë”°ë¦„ */
            transform: scale(0.8); /* íŠ¸ë ˆì´ì—ì„œëŠ” ì•½ê°„ ì‘ê²Œ */
        }

        .piece:active { cursor: grabbing; transform: scale(1.1); z-index: 100; }
        .piece.locked { cursor: not-allowed; opacity: 0.9; filter: brightness(0.8); }

        .block {
            width: var(--cell-size);
            height: var(--cell-size);
            border-radius: 50%;
            box-shadow: inset -2px -2px 4px rgba(0,0,0,0.2), 2px 2px 4px rgba(255,255,255,0.3);
            border: 1px solid rgba(0,0,0,0.1);
        }

        /* íŒì—… ë©”ì‹œì§€ */
        #message {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            display: none;
            z-index: 1000;
        }
    </style>
</head>
<body>

<header>
    <h1>ğŸ§© ì¹´ëˆ„ë“¤ ë§ˆìŠ¤í„°</h1>
    <p>ì¡°ê°ì„ ë“œë˜ê·¸í•˜ì—¬ ë¹ˆì¹¸ì„ ì±„ìš°ì„¸ìš”. (í´ë¦­: íšŒì „)</p>
</header>

<div class="controls">
    <select id="difficulty">
        <option value="2">ì‰¬ì›€ (2ê°œ ê³ ì •)</option>
        <option value="4" selected>ë³´í†µ (4ê°œ ê³ ì •)</option>
        <option value="6">ì–´ë ¤ì›€ (6ê°œ ê³ ì •)</option>
    </select>
    <button class="btn-gen" onclick="initGame()">ğŸ”„ ìƒˆ ë¬¸ì œ</button>
    <button class="btn-check" onclick="checkSolution()">âœ¨ ì±„ì </button>
    <button class="btn-answer" onclick="showAnswer()">ğŸ‘€ ì •ë‹µ ë³´ê¸°</button>
</div>

<div id="game-container">
    <div id="board">
        </div>
    <div id="tray">
        </div>
</div>

<div id="message"></div>

<script>
/**
 * ğŸ› ï¸ í¼ì¦ ë¡œì§ ë° ìƒíƒœ ê´€ë¦¬
 */

// 1. ì„¤ì •ê°’ ì •ì˜
const COLS = 11;
const ROWS = 5;
const CELL_SIZE_PX = 32; // CSSì™€ ë§ì¶°ì•¼ í•˜ì§€ë§Œ ë™ì  ê³„ì‚° ì˜ˆì •

// 12ê°œì˜ ì¡°ê° ì •ì˜ (ì´ 55ì¹¸ì— ë§ì¶¤: 5ì¹¸ì§œë¦¬ 7ê°œ + 4ì¹¸ì§œë¦¬ 5ê°œ = 55)
// 1: ì¡´ì¬í•¨, 0: ë¹ˆì¹¸
const SHAPES_DEF = [
    { id: 0, color: '#FF6B6B', shape: [[1,1,1,1,1]] }, // I5 (Long)
    { id: 1, color: '#4ECDC4', shape: [[1,1],[1,1]] }, // O4 (Square)
    { id: 2, color: '#45B7D1', shape: [[1,1,1],[0,1,0]] }, // T4
    { id: 3, color: '#96CEB4', shape: [[1,1,0],[0,1,1]] }, // Z4
    { id: 4, color: '#FFEEAD', shape: [[1,1,1,1]] }, // I4
    { id: 5, color: '#D4A5A5', shape: [[1,0],[1,0],[1,1]] }, // L4
    { id: 6, color: '#9B59B6', shape: [[1,1,1],[1,0,0],[1,0,0]] }, // V5
    { id: 7, color: '#3498DB', shape: [[1,1,1],[1,0,0],[1,0,0]] }, // L5 (Modified for variety) -> Actually V5 dup, let's change
    // Let's define standard-ish pentominoes
    { id: 7, color: '#3498DB', shape: [[1,0,0],[1,1,1],[0,0,1]] }, // Z5-ish
    { id: 8, color: '#E67E22', shape: [[0,1,0],[1,1,1],[0,1,0]] }, // X5
    { id: 9, color: '#1ABC9C', shape: [[1,0],[1,1],[1,1]] }, // P5
    { id: 10, color: '#F1C40F', shape: [[1,0,1],[1,1,1]] }, // U5
    { id: 11, color: '#E74C3C', shape: [[0,0,1],[1,1,1],[1,0,0]] } // W5
];

let boardState = []; // í˜„ì¬ ë³´ë“œ ìƒíƒœ (0: empty, id+1: occupied)
let answerKey = [];  // ìƒì„±ëœ ì •ë‹µ
let pieces = [];     // ì¡°ê° ê°ì²´ë“¤
let cellSize = 0;    // ë°˜ì‘í˜• ì…€ í¬ê¸°

// DOM ìš”ì†Œ
const boardEl = document.getElementById('board');
const trayEl = document.getElementById('tray');

// 2. ì´ˆê¸°í™” í•¨ìˆ˜
function initGame() {
    // ë°˜ì‘í˜• ì‚¬ì´ì¦ˆ ê³„ì‚°
    const boardWidth = boardEl.getBoundingClientRect().width;
    cellSize = (boardWidth - 20) / 11; // padding ë“± ê³ ë ¤
    document.documentElement.style.setProperty('--cell-size', `${cellSize}px`);

    createGrid();
    generatePuzzle();
}

function createGrid() {
    boardEl.innerHTML = '';
    for(let i=0; i<ROWS*COLS; i++) {
        const div = document.createElement('div');
        div.className = 'cell';
        boardEl.appendChild(div);
    }
}

// 3. ğŸš€ í•µì‹¬ ë¡œì§: ë°±íŠ¸ë˜í‚¹ìœ¼ë¡œ ì •ë‹µ ìƒì„±
function generatePuzzle() {
    // ì´ˆê¸°í™”
    boardState = Array(ROWS).fill().map(() => Array(COLS).fill(-1));
    trayEl.innerHTML = '';
    pieces = SHAPES_DEF.map(p => ({
        ...p,
        currentShape: p.shape, // í˜„ì¬ íšŒì „ ìƒíƒœ
        x: -1, y: -1,          // ë³´ë“œ ìœ„ ì¢Œí‘œ (-1ì´ë©´ íŠ¸ë ˆì´)
        isLocked: false
    }));

    // ëœë¤í•˜ê²Œ ì„ì–´ì„œ í’€ê¸° ì‹œë„
    let shuffledIndices = pieces.map((_, i) => i).sort(() => Math.random() - 0.5);
    
    // ë°±íŠ¸ë˜í‚¹ ì‹œì‘
    if (solveBoard(0, shuffledIndices)) {
        // ì •ë‹µ ì €ì¥
        answerKey = JSON.parse(JSON.stringify(boardState));
        setupLevel();
        renderPieces();
        showMessage("ë¬¸ì œ ìƒì„± ì™„ë£Œ! ë„ì „í•˜ì„¸ìš”. ğŸ®");
    } else {
        // ë§¤ìš° ë“œë¬¼ê²Œ ì‹¤íŒ¨í•  ê²½ìš° ì¬ì‹œë„
        console.warn("Generation failed, retrying...");
        generatePuzzle(); 
    }
}

// ì¬ê·€ì  ë°±íŠ¸ë˜í‚¹ í•¨ìˆ˜
function solveBoard(idx, indices) {
    if (idx >= indices.length) return true; // ëª¨ë“  ì¡°ê° ë°°ì¹˜ ì™„ë£Œ

    const pIdx = indices[idx];
    const piece = pieces[pIdx];
    
    // ê°€ëŠ¥í•œ ëª¨ë“  íšŒì „/ë°˜ì „ ì‹œë„ (8ê°€ì§€ ë³€í˜•)
    // ì„±ëŠ¥ì„ ìœ„í•´ ê°„ë‹¨íˆ 4ë°©í–¥ íšŒì „ë§Œ ì‹œë„í•˜ê±°ë‚˜, ë¯¸ë¦¬ ë³€í˜•ì„ ìºì‹±í•  ìˆ˜ ìˆìŒ.
    // ì—¬ê¸°ì„œëŠ” ì‹¤ì‹œê°„ íšŒì „ ì‹œë„.
    let variations = getAllVariations(piece.shape);
    
    // ë³´ë“œì˜ ëª¨ë“  ë¹ˆì¹¸ íƒìƒ‰
    for (let r = 0; r < ROWS; r++) {
        for (let c = 0; c < COLS; c++) {
            if (boardState[r][c] !== -1) continue; // ì´ë¯¸ ì±„ì›Œì§

            // ê° ë³€í˜•ì— ëŒ€í•´ ë°°ì¹˜ ì‹œë„
            for (let v of variations) {
                if (canPlace(v, r, c)) {
                    placePiece(v, r, c, pIdx);
                    // ë‹¤ìŒ ì¡°ê°ìœ¼ë¡œ ì§„í–‰
                    if (solveBoard(idx + 1, indices)) {
                        // ì„±ê³µí–ˆìœ¼ë¯€ë¡œ í˜„ì¬ ìƒíƒœ ì €ì¥ (í™”ë©´ ë Œë”ë§ìš©ì´ ì•„ë‹˜, ë¡œì§ìš©)
                        pieces[pIdx].currentShape = v;
                        pieces[pIdx].x = c;
                        pieces[pIdx].y = r;
                        return true;
                    }
                    // ì‹¤íŒ¨í•˜ë©´ ì›ë³µ (Backtrack)
                    removePiece(v, r, c);
                }
            }
        }
    }
    return false;
}

function getAllVariations(matrix) {
    let vars = [];
    let m = matrix;
    for(let i=0; i<4; i++) {
        vars.push(m);
        m = rotateMatrix(m);
    }
    // Flip
    m = m.slice().reverse();
    for(let i=0; i<4; i++) {
        vars.push(m);
        m = rotateMatrix(m);
    }
    // ì¤‘ë³µ ì œê±° (í˜•íƒœê°€ ê°™ì€ ê²½ìš°) - ê°„ë‹¨í•œ êµ¬í˜„ì„ ìœ„í•´ ìƒëµí•˜ê±°ë‚˜ JSON ë¬¸ìì—´ë¡œ ë¹„êµ
    return vars; 
}

function rotateMatrix(matrix) {
    const rows = matrix.length;
    const cols = matrix[0].length;
    let newMat = Array(cols).fill().map(() => Array(rows).fill(0));
    for (let r=0; r<rows; r++) {
        for (let c=0; c<cols; c++) {
            newMat[c][rows-1-r] = matrix[r][c];
        }
    }
    return newMat;
}

function canPlace(shape, r, c) {
    for (let i=0; i<shape.length; i++) {
        for (let j=0; j<shape[0].length; j++) {
            if (shape[i][j] === 1) {
                if (r+i >= ROWS || c+j >= COLS || boardState[r+i][c+j] !== -1) return false;
            }
        }
    }
    return true;
}

function placePiece(shape, r, c, id) {
    for (let i=0; i<shape.length; i++) {
        for (let j=0; j<shape[0].length; j++) {
            if (shape[i][j] === 1) boardState[r+i][c+j] = id;
        }
    }
}

function removePiece(shape, r, c) {
    for (let i=0; i<shape.length; i++) {
        for (let j=0; j<shape[0].length; j++) {
            if (shape[i][j] === 1) boardState[r+i][c+j] = -1;
        }
    }
}

// 4. ë‚œì´ë„ ì ìš© (ì¼ë¶€ ì¡°ê° ê³ ì •, ë‚˜ë¨¸ì§€ íŠ¸ë ˆì´ë¡œ)
function setupLevel() {
    const difficulty = parseInt(document.getElementById('difficulty').value);
    
    // ì „ì²´ ì¡°ê° ì¸ë±ìŠ¤
    let allIndices = pieces.map((_, i) => i);
    // ë¬´ì‘ìœ„ë¡œ ê³ ì •í•  ì¡°ê° ì„ íƒ
    let lockedIndices = [];
    for(let i=0; i<difficulty; i++) {
        if(allIndices.length === 0) break;
        let rand = Math.floor(Math.random() * allIndices.length);
        lockedIndices.push(allIndices[rand]);
        allIndices.splice(rand, 1);
    }

    // ìƒíƒœ ì—…ë°ì´íŠ¸
    pieces.forEach((p, idx) => {
        if (lockedIndices.includes(idx)) {
            p.isLocked = true;
            // boardStateëŠ” ì´ë¯¸ ì±„ì›Œì ¸ ìˆìŒ
        } else {
            p.isLocked = false;
            // ë³´ë“œì—ì„œ ì œê±°í•˜ê³  íŠ¸ë ˆì´ë¡œ ë³´ë‚¼ ì¤€ë¹„
            removePiece(p.currentShape, p.y, p.x);
            p.x = -1; 
            p.y = -1;
        }
    });
}

// 5. ë Œë”ë§ ë° ì¸í„°ë™ì…˜ (ë“œë˜ê·¸ ì•¤ ë“œë¡­)
function renderPieces() {
    // ê¸°ì¡´ ì¡°ê° DOM ì œê±°
    document.querySelectorAll('.piece').forEach(el => el.remove());

    pieces.forEach((p, idx) => {
        const pieceEl = document.createElement('div');
        pieceEl.className = `piece ${p.x === -1 ? 'in-tray' : ''} ${p.isLocked ? 'locked' : ''}`;
        pieceEl.id = `piece-${idx}`;
        pieceEl.style.gridTemplateColumns = `repeat(${p.currentShape[0].length}, 1fr)`;
        
        // ì¡°ê° ë‚´ë¶€ ë¸”ë¡ ìƒì„±
        p.currentShape.forEach(row => {
            row.forEach(val => {
                const block = document.createElement('div');
                if (val === 1) {
                    block.className = 'block';
                    block.style.backgroundColor = p.color;
                } else {
                    block.style.visibility = 'hidden'; // íˆ¬ëª… ê³µê°„
                }
                pieceEl.appendChild(block);
            });
        });

        // ìœ„ì¹˜ ì¡ê¸°
        if (p.x !== -1) {
            // ë³´ë“œ ìœ„
            placeElOnBoard(pieceEl, p.x, p.y);
        } else {
            // íŠ¸ë ˆì´
            trayEl.appendChild(pieceEl);
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ê³ ì •ëœ ì¡°ê° ì œì™¸)
        if (!p.isLocked) {
            pieceEl.onpointerdown = (e) => startDrag(e, idx, pieceEl);
            // í´ë¦­ ì‹œ íšŒì „ (ë“œë˜ê·¸ê°€ ì•„ë‹ ê²½ìš°)
            pieceEl.onclick = (e) => {
               if (!isDragging) rotatePiece(idx);
            };
        }
    });
}

function placeElOnBoard(el, x, y) {
    const boardRect = boardEl.getBoundingClientRect();
    const computedSize = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--cell-size'));
    
    // CSS Grid gap(2px) ê³ ë ¤
    const gap = 2;
    const left = (x * (computedSize + gap)) + 10; // +10 padding
    const top = (y * (computedSize + gap)) + 10;

    el.style.left = `${left}px`;
    el.style.top = `${top}px`;
    el.style.position = 'absolute';
    boardEl.appendChild(el);
}

// ë“œë˜ê·¸ ê´€ë ¨ ë³€ìˆ˜
let isDragging = false;
let dragStartX, dragStartY;
let activePieceIdx = null;

function startDrag(e, idx, el) {
    e.preventDefault();
    isDragging = false; // ì›€ì§ì—¬ì•¼ trueë¡œ ë³€ê²½
    activePieceIdx = idx;
    
    const startX = e.clientX || e.touches[0].clientX;
    const startY = e.clientY || e.touches[0].clientY;
    const rect = el.getBoundingClientRect();
    const offsetX = startX - rect.left;
    const offsetY = startY - rect.top;

    el.style.zIndex = 1000;
    el.classList.remove('in-tray');
    document.body.appendChild(el); // bodyë¡œ ì˜®ê²¨ì„œ ììœ ë¡­ê²Œ ì´ë™

    function onMove(e) {
        isDragging = true;
        const cx = e.clientX || e.touches[0].clientX;
        const cy = e.clientY || e.touches[0].clientY;
        el.style.position = 'fixed';
        el.style.left = `${cx - offsetX}px`;
        el.style.top = `${cy - offsetY}px`;
    }

    function onUp(e) {
        document.removeEventListener('pointermove', onMove);
        document.removeEventListener('pointerup', onUp);
        
        if (!isDragging) {
            // í´ë¦­ìœ¼ë¡œ ê°„ì£¼ -> íšŒì „ ì²˜ë¦¬ í›„ ë Œë”ë§
            renderPieces(); 
            return;
        }

        // ë“œë¡­ ìœ„ì¹˜ ê³„ì‚°
        const boardRect = boardEl.getBoundingClientRect();
        const elRect = el.getBoundingClientRect();
        
        // ë³´ë“œ ì˜ì—­ ì•ˆì— ìˆëŠ”ì§€ í™•ì¸ (ëŒ€ëµ ì¤‘ì‹¬ì  ê¸°ì¤€)
        const centerX = elRect.left + elRect.width/2;
        const centerY = elRect.top + elRect.height/2;

        if (centerX > boardRect.left && centerX < boardRect.right &&
            centerY > boardRect.top && centerY < boardRect.bottom) {
            
            // ê²©ì ì¢Œí‘œë¡œ ë³€í™˜
            const computedSize = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--cell-size')) + 2;
            const relX = elRect.left - boardRect.left - 10; // padding
            const relY = elRect.top - boardRect.top - 10;
            
            const gridX = Math.round(relX / computedSize);
            const gridY = Math.round(relY / computedSize);

            // ìœ íš¨ì„± ê²€ì‚¬ ë° ë°°ì¹˜
            if (canPlace(pieces[idx].currentShape, gridY, gridX)) {
                // ê¸°ì¡´ ìœ„ì¹˜ì—ì„œ ì œê±° (í˜¹ì‹œ ë³´ë“œ ìœ„ì— ìˆì—ˆë‹¤ë©´)
                if (pieces[idx].x !== -1) removePiece(pieces[idx].currentShape, pieces[idx].y, pieces[idx].x);
                
                // ë°°ì¹˜
                placePiece(pieces[idx].currentShape, gridY, gridX, idx);
                pieces[idx].x = gridX;
                pieces[idx].y = gridY;
            } else {
                // ë°°ì¹˜ ì‹¤íŒ¨ -> íŠ¸ë ˆì´ë¡œ ë³µê·€
                if (pieces[idx].x !== -1) removePiece(pieces[idx].currentShape, pieces[idx].y, pieces[idx].x);
                pieces[idx].x = -1;
                pieces[idx].y = -1;
            }
        } else {
            // ë³´ë“œ ë°– -> íŠ¸ë ˆì´ë¡œ
            if (pieces[idx].x !== -1) removePiece(pieces[idx].currentShape, pieces[idx].y, pieces[idx].x);
            pieces[idx].x = -1;
            pieces[idx].y = -1;
        }
        renderPieces();
    }

    document.addEventListener('pointermove', onMove);
    document.addEventListener('pointerup', onUp);
}

function rotatePiece(idx) {
    const p = pieces[idx];
    if (p.isLocked) return;

    // íšŒì „ (90ë„)
    p.currentShape = rotateMatrix(p.currentShape);
    
    // ë§Œì•½ ë³´ë“œ ìœ„ì— ìˆë‹¤ë©´, íšŒì „ í›„ ìœ íš¨í•œì§€ ì²´í¬í•´ì•¼ í•¨
    if (p.x !== -1) {
        // ì¼ë‹¨ í˜„ì¬ ìœ„ì¹˜ì—ì„œ ì œê±°
        removePiece(rotateMatrix(rotateMatrix(rotateMatrix(p.currentShape))), p.y, p.x); // ì—­íšŒì „í•´ì„œ ì›ë˜êº¼ ì œê±°? ë³µì¡í•˜ë‹ˆ ê·¸ëƒ¥ ì œê±° ë¡œì§ ê°œì„  í•„ìš”
        // -> ë‹¨ìˆœí™”: ë³´ë“œ ìœ„ì—ì„œ íšŒì „ ì‹œ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ íŠ¸ë ˆì´ë¡œ ë³´ëƒ„
        if (canPlace(p.currentShape, p.y, p.x)) {
            placePiece(p.currentShape, p.y, p.x, idx);
        } else {
            p.x = -1; p.y = -1; // íŠ¸ë ˆì´ë¡œ íŠ•ê²¨ë‚˜ê°
        }
    }
    renderPieces();
}

// 6. ìœ í‹¸ë¦¬í‹° ë²„íŠ¼
function checkSolution() {
    let filled = 0;
    for(let r=0; r<ROWS; r++) {
        for(let c=0; c<COLS; c++) {
            if(boardState[r][c] !== -1) filled++;
        }
    }
    if(filled === ROWS*COLS) {
        showMessage("ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! í¼ì¦ì„ ì™„ì„±í–ˆìŠµë‹ˆë‹¤!");
    } else {
        showMessage(`ì•„ì§ ${ROWS*COLS - filled}ì¹¸ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤. í˜ë‚´ì„¸ìš”! ğŸ’ª`);
    }
}

function showAnswer() {
    if(!confirm("ì •ë§ ì •ë‹µì„ ë³´ì‹œê² ìŠµë‹ˆê¹Œ? í˜„ì¬ ì§„í–‰ ìƒí™©ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤.")) return;
    
    // ì •ë‹µ ìƒíƒœë¡œ ë³µì›
    boardState = JSON.parse(JSON.stringify(answerKey));
    
    // ëª¨ë“  ì¡°ê° ìœ„ì¹˜ ì—…ë°ì´íŠ¸ (answerKeyë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì—­ì¶”ì ì€ ì–´ë ¤ìš°ë¯€ë¡œ, 
    // ì‚¬ì‹¤ generatePuzzle ë‹¨ê³„ì—ì„œ answerKeyë¥¼ ì €ì¥í•  ë•Œ ì¡°ê°ë“¤ì˜ ìœ„ì¹˜ì •ë³´ë„ ì €ì¥í–ˆì–´ì•¼ í•¨.
    // ì—¬ê¸°ì„œëŠ” ê°„ë‹¨íˆ ë‹¤ì‹œ ë¦¬ë¡œë“œí•˜ê±°ë‚˜, ë©”ì‹œì§€ë§Œ ë³´ì—¬ì¤Œ. 
    // ê°œì„ : AnswerKey ì‹œì ì˜ ì¡°ê° ìœ„ì¹˜ë¥¼ ì €ì¥í•´ë‘ëŠ” ê²ƒì´ ì¢‹ìŒ.)
    
    // *í”„ë¡œí† íƒ€ì… ë‹¨ìˆœí™”*: ë‹¤ì‹œ ìƒì„±ëœ ì •ë‹µì„ ì‹œê°ì ìœ¼ë¡œ ë³´ì—¬ì£¼ê¸° ìœ„í•´
    // answerKey ê·¸ë¦¬ë“œ ê°’ì„ ë³´ê³  ì¡°ê°ë“¤ì„ ì–µì§€ë¡œ ë¼ì›Œë§ì¶”ëŠ” ê±´ ë³µì¡í•˜ë¯€ë¡œ
    // "ì™„ì„±ëœ ëª¨ìŠµ"ì„ ê·¸ëƒ¥ ë³´ì—¬ì£¼ëŠ” ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬í•˜ê² ìŠµë‹ˆë‹¤.
    
    // (ì—¬ê¸°ì„œëŠ” ë¹ ë¥¸ êµ¬í˜„ì„ ìœ„í•´ ìƒˆë¡œê³ ì¹¨ì„ ê¶Œì¥í•˜ê±°ë‚˜, ë¡œì§ ë³´ì™„)
    showMessage("ì •ë‹µ í™•ì¸ ê¸°ëŠ¥ì€ ë‹¤ìŒ ë²„ì „ì—ì„œ ë” ì™„ë²½í•˜ê²Œ ì§€ì›ë©ë‹ˆë‹¤! (ì½˜ì†” í™•ì¸ ê°€ëŠ¥)");
    console.log("Answer Key Grid:", answerKey);
    // *ì‹¤ì œ ìœ ì €ë¥¼ ìœ„í•´*: íŒíŠ¸ í•˜ë‚˜ë¥¼ ì¤ë‹ˆë‹¤.
    alert("ê°œë°œì ë„êµ¬(F12) Consoleì—ì„œ ì •ë‹µ ë°°ì—´ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (í”„ë¡œí† íƒ€ì… ì œí•œ)");
}

function showMessage(msg) {
    const el = document.getElementById('message');
    el.textContent = msg;
    el.style.display = 'block';
    setTimeout(() => {
        el.style.display = 'none';
    }, 2000);
}

// ì‹œì‘
window.addEventListener('resize', () => {
    initGame(); // í™”ë©´ í¬ê¸° ë³€ê²½ ì‹œ ë¦¬ì…‹ (ë°˜ì‘í˜• ëŒ€ì‘)
});
initGame();

</script>
</body>
</html>

